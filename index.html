<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relojes Sala de Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
/* =================================================
  ESTILOS PRINCIPALES DEL DASHBOARD
  - Define la apariencia general del cuerpo, fondo
    y los contenedores principales.
================================================= 
*/
body {
    background-color: #07121f;
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
}

.dashboard-container {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    background: url('https://e1.pxfuel.com/desktop-wallpaper/415/399/desktop-wallpaper-black-world-map-displaying-17-gallery-for-black-world-1440x900-for-your-mobile-tablet-dark-map.jpg') no-repeat center center fixed;
    background-size: cover;
}

.overlay {
    height: 100%;
    width: 100%;
    background-color: rgba(7, 18, 31, 0.9);
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    overflow: hidden;
    position: relative;
}

/* =================================================
  ESTILOS DE LA BARRA SUPERIOR (HEADER)
  - Diseño de la barra de título superior.
  - Se añade un ID para excluirla del evento de doble clic.
================================================= 
*/
.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #f7f7f7;
    font-weight: 900;
    font-size: 28px;
    margin-bottom: 20px;
}
.header-title {
    color: #00aaff;
}
.header-control {
    color: #f7f7f7;
}

/* =================================================
  ESTILOS DE LOS RELOJES INDIVIDUALES
  - Contenedor para cada reloj, con propiedades de arrastre.
  - La propiedad `overflow: hidden` es clave para que 
    las animaciones del clima se mantengan dentro de los límites.
================================================= 
*/
.clock-container {
    position: absolute;
    padding: 15px;
    border-radius: 10px;
    background-color: #0b1a2a;
    color: #f7f7f7;
    text-align: center;
    width: 220px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    cursor: grab;
    z-index: 10;
    overflow: hidden;
    transition: background-color 0.5s ease;
}
.clock-container:active {
    cursor: grabbing;
}
.clock-container.moving {
    z-index: 20;
}

/* =================================================
  ESTILOS DE LOS TEXTOS Y RELOJ
  - Diseño de los elementos dentro de cada reloj:
    nombre de la ciudad, bandera, temperatura, etc.
================================================= 
*/
.header-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
}
.city-name { 
    font-size: 20px; 
    font-weight: bold; 
    color: #00aaff; 
}
.country-flag {
    width: 25px;
    height: auto;
    border: 1px solid #7b7b7b;
    border-radius: 2px;
}
.day-night-icon {
    width: 25px;
    height: 25px;
}
.day-night-icon svg {
    fill: #f7f7f7;
    width: 100%;
    height: 100%;
}
.country-name { 
    font-size: 14px; 
    margin-bottom: 10px; 
    color: #7b7b7b; 
}
.temperature { 
    font-size: 18px; 
    margin-top: 5px; 
    color: #9e9e9e;
}
.clock { 
    display: flex; 
    justify-content: center; 
    gap: 2px; 
    align-items: center;
}
.digit { 
    font-family: 'Montserrat', sans-serif, monospace;
    font-size: 50px;
    font-weight: 500;
    width: 33px; 
    height: 40px; 
    overflow: hidden; 
    position: relative; 
    text-shadow: 0 0 2px currentColor; 
    color: #f7f7f7;
}
.gray-digit { color: #7b7b7b; }
.separator { 
    font-family: 'Montserrat', monospace; 
    font-size: 42px;
    font-weight: bold;
    line-height: 56px;
    transform: translateY(-2px);
    margin: 0 -1px;
    color: #f7f7f7;
}
.separator.gray { color: #7b7f7b; }
.chain {
    position: absolute;
    top: 0;
    left: 0;
    transition: transform 0.9s cubic-bezier(0.8, 0, 0.2, 1);
}
.chain.no-transition { transition: none; }
.chain div { height: 39px; line-height: 39px; text-align: center; }

/* =================================================
  NUEVO ESTILO PARA LATITUD Y LONGITUD
  - Clase para el texto de coordenadas.
  - El cursor cambia a "pointer" para indicar que es clickeable.
================================================= 
*/


/* =================================================  NUEVO ESTILO PARA LATITUD Y LONGITUD  - Clase para el texto de coordenadas.  - El cursor cambia a "pointer" para indicar que es clickeable.================================================= */

.coordinates {
  font-size: 11px;
  color: #7b7b7b;
  margin-top: 6px;
  cursor: pointer;
  font-weight: bold;
  user-select: none;
  display: inline-block;
  /* asegura área más grande */
  padding: 3px 6px;       /* aumenta espacio clickeable */
  border-radius: 4px;     /* para un hover más claro */
  position: relative; /* Añade esta línea */
  z-index: 15; /* Asegura que esté por encima de las animaciones */
}

.coordinates:hover {
  color: #00aaff;
  background-color: rgba(255, 255, 255, 0.05); /* resalta al pasar */
}

/* =================================================
  ESTILOS DE ANIMACIÓN DEL CLIMA
  - Estas clases se añaden dinámicamente con JavaScript
    para crear los efectos visuales.
  - Usan pseudo-elementos (`::before` y `::after`)
    para los efectos sin alterar el contenido principal.
================================================= 
*/
.weather-clouds {
    background-color: #122131;
}
.weather-clouds::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M20 50 A30 15 0 0 1 80 50 A20 10 0 0 1 70 70 A30 20 0 0 1 20 70 A25 10 0 0 1 20 50z' fill='%23ffffff' opacity='0.1'/%3E%3C/svg%3E");
    background-size: 50% 50%;
    animation: moveClouds 25s linear infinite;
    opacity: 0.8;
}

@keyframes moveClouds {
    0% { background-position: 0 0; }
    100% { background-position: 100% 0; }
}

.weather-rainy {
    background-color: #101c2a;
}
.weather-rainy::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0 L50 100' stroke='%2388c5e6' stroke-width='2' opacity='0.5'/%3E%3C/svg%3E");
    background-size: 10px 100%;
    animation: rain 1s linear infinite;
}

@keyframes rain {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
}

.weather-storm {
    background-color: #0d1620;
}
.weather-storm::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0d1620;
    animation: stormFlash 4s linear infinite;
    opacity: 0.9;
}
.weather-storm::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0 L50 100' stroke='%2388c5e6' stroke-width='2' opacity='0.5'/%3E%3C/svg%3E");
    background-size: 10px 100%;
    animation: rain 1s linear infinite;
}

@keyframes stormFlash {
    0%, 100% { background-color: rgba(255, 255, 255, 0); }
    10%, 12% { background-color: rgba(255, 255, 255, 0.2); }
}
</style>
</head>
<body>

<div class="dashboard-container">
    <div class="overlay">
        <div class="header-container" id="header-bar">
            <div class="header-title">GLOBAL SCADA GALILEO</div>
            <div class="header-control">Sala de Control</div>
        </div>
        <div id="clocks-root"></div>
    </div>
</div>

<script>
/*
=================================================
  CONFIGURACIÓN Y VARIABLES GLOBALES
  - `digitHeight`: Altura de cada dígito para la animación.
  - `apiKey`: Clave para la API de WeatherAPI.
  - `clocksConfig`: La lista de ciudades con sus detalles,
    incluyendo las coordenadas lat/lon para la API de clima.
=================================================
*/
const digitHeight = 39;
const apiKey = '8047d34429cf4fa9a6a151939243009';

//solo lat, long y timezone deben ser precisas, el resto se puede editar tranquilamente y no altera el código
const clocksConfig = [
    { id: 'mendoza', city: 'Mendoza', displayName: 'La Mora', country: 'Mendoza', lat: -35.10563, lon: -66.83004, timezone: 'America/Argentina/Mendoza', flag: 'https://flagcdn.com/w20/ar.png', top: 140, left: 50 },
    { id: 'buquebus', city: 'Buqu', displayName: 'Buquebus', country: 'Argentina', lat: -35.04487, lon: -58.322822, timezone: 'America/Argentina/Buenos_Aires', flag: 'https://flagcdn.com/w20/ar.png', top: 140, left: 320 },
    { id: 'garden city', city: 'garden city', displayName: 'Garden', country: 'EDGE TX - USA', lat: 31.847623, lon: -101.4473, timezone: 'America/Chicago', flag: 'https://flagcdn.com/w20/us.png', top: 140, left: 1330 },
    { id: 'midland', city: 'Midland', displayName: 'Mentone', country: 'EDGE TX - USA', lat: 31.751634, lon: -103.507194, timezone: 'America/Chicago', flag: 'https://flagcdn.com/w20/us.png', top: 140, left: 1600 },
    { id: 'paita', city: 'Paita', displayName: 'Paita', country: 'Perú', lat: -4.995918, lon: -81.041703, timezone: 'America/Lima', flag: 'https://flagcdn.com/w20/pe.png', top: 360, left: 320 },
    { id: 'sahagun', city: 'Sahagún', displayName: 'Canacol', country: 'Colombia', lat: 8.640156, lon: -75.384262, timezone: 'America/Bogota', flag: 'https://flagcdn.com/w20/co.png', top: 360, left: 50 },
    { id: 'gail', city: 'Gail', displayName: 'Gail', country: 'India', lat: 28.589107, lon: 77.180263, timezone: 'Asia/Kolkata', flag: 'https://flagcdn.com/w20/in.png', top: 360, left: 1330 },
    { id: 'Wira', city: 'Indo', displayName: 'wiraaa', country: 'Indonesia', timezone: 'Asia/Jakarta', lat: -6.196633, lon: 106.818185, flag: 'https://flagcdn.com/w20/id.png', top: 360, left: 1600 },
    { id: 'mato-grosso', city: 'Mato Grosso do Sul', displayName: 'Adecoagro', country: 'Brasil', lat: -22.393861, lon: -53.893778, timezone: 'America/Campo_Grande', flag: 'https://flagcdn.com/w20/br.png', top: 580, left: 180 },
    { id: 'northern-ireland', city: 'Northern Ireland', displayName: 'Greenville', country: 'Irlanda del Norte', lat: 54.718835, lon: -7.488677, timezone: 'Europe/London', flag: 'https://flagcdn.com/w20/gb.png', top: 580, left: 1480 }
];

// Código SVG para los iconos de día y noche
const dayIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 20h2v3h-2v-3zM3.515 4.929l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm16.97 16.97l1.414-1.414-2.121-2.121-1.414 1.414 2.121 2.121zm-2.121-2.121l1.414 1.414 2.121-2.121-1.414-1.414-2.121 2.121zM5.636 18.364l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM1 11h3v2H1v-2zm20 0h3v2h-3v-2zm-3.586-5.414l-1.414-1.414-2.121 2.121 1.414 1.414 2.121-2.121zM4.293 19.707l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121z"/></svg>`;
const nightIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21a9 9 0 0 1-9-9c0-.943.176-1.85.518-2.693A6.5 6.5 0 1 0 18.5 19.5c.928-.291 1.776-.78 2.502-1.432A9 9 0 0 1 12 21z"/></svg>`;

// Genera la cadena de dígitos para las animaciones del reloj
function createChain(max) {
    let html = "";
    for (let i = 0; i < max; i++) html += `<div>${i}</div>`;
    html += `<div>0</div>`; // El dígito extra es para la animación de "rollover"
    return html;
}

// Genera el HTML de un reloj con su posición inicial
function createClockHTML(cfg) {
    // CORREGIDO: Se crea el link de Google Maps con las coordenadas en el formato correcto
    
    

    
    

    const googleMapsLink = `http://maps.google.com/?q=${cfg.lat},${cfg.lon}`;
    

    return `
    <div class="clock-container" id="${cfg.id}" style="top: ${cfg.top}px; left: ${cfg.left}px;">
        <div class="header-row">
            <img class="country-flag" src="${cfg.flag}" alt="${cfg.country} flag">
            <div class="city-name">${cfg.displayName}</div>
            <div class="day-night-icon" id="day-night-icon-${cfg.id}"></div>
        </div>
        <div class="country-name">${cfg.country}</div>
        <div class="clock">
          <div class="digit"><div class="chain" data-role="hourTens">${createChain(3)}</div></div>
          <div class="digit"><div class="chain" data-role="hourUnits">${createChain(10)}</div></div>
          <div class="separator">:</div>
          <div class="digit"><div class="chain" data-role="minTens">${createChain(6)}</div></div>
          <div class="digit"><div class="chain" data-role="minUnits">${createChain(10)}</div></div>
          <div class="separator gray">:</div>
          <div class="digit gray-digit"><div class="chain" data-role="secTens">${createChain(6)}</div></div>
          <div class="digit gray-digit"><div class="chain" data-role="secUnits">${createChain(10)}</div></div>
        </div>
        <div class="temperature" id="temp-${cfg.id}">Temperatura: -- °C</div>
        <div class="coordinates" id="coords-${cfg.id}">
  Coordenadas: ${cfg.lat.toFixed(3)}, ${cfg.lon.toFixed(3)}
</div>

        <a href="${googleMapsLink}" target="_blank" class="map-link" id="map-link-${cfg.id}" style="display:none;"></a>
    </div>`;
}

// Inserta todos los relojes en el contenedor principal del DOM
const root = document.getElementById("clocks-root");
clocksConfig.forEach(cfg => root.innerHTML += createClockHTML(cfg));

/*
=================================================
  CLASE CLOCK PARA GESTIONAR CADA RELOJ
  - Abstrae la lógica de actualización para cada reloj.
=================================================
*/
class Clock {
  constructor(cfg) {
    this.cfg = cfg;
    const el = document.getElementById(cfg.id);
    this.el = el;
    this.hourTens = el.querySelector('[data-role="hourTens"]');
    this.hourUnits = el.querySelector('[data-role="hourUnits"]');
    this.minTens = el.querySelector('[data-role="minTens"]');
    this.minUnits = el.querySelector('[data-role="minUnits"]');
    this.secTens = el.querySelector('[data-role="secTens"]');
    this.secUnits = el.querySelector('[data-role="secUnits"]');
    this.dayNightIcon = document.getElementById(`day-night-icon-${cfg.id}`);

    // CORREGIDO: Se genera el link de Google Maps con el formato correcto
    this.coordinatesEl = document.getElementById(`coords-${cfg.id}`);


  this.coordinatesEl.addEventListener('click', () => {       

   const query = `${this.cfg.lat},${this.cfg.lon}`;       const url = `http://maps.google.com/?q=${query}`;

    window.open(url, '_blank');    });
  }


  // Actualiza la posición de cada cadena de dígitos para mostrar la hora correcta
  updateDigit(element, currentValue, max) {
    let prev = parseInt((element.style.transform || "translateY(0px)").replace(/[^0-9]/g, "")) / digitHeight || 0;
    if (currentValue === 0 && prev === max - 1) {
      element.style.transform = `translateY(-${max * digitHeight}px)`;
      setTimeout(() => {
        element.classList.add("no-transition");
        element.style.transform = `translateY(0px)`;
        setTimeout(() => element.classList.remove("no-transition"), 50);
      }, 900);
      return;
    }
    element.style.transform = `translateY(-${currentValue * digitHeight}px)`;
  }

  // Lógica principal para actualizar la hora y el icono de día/noche
  update(baseDate) {
    const now = new Date(baseDate);
    const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: this.cfg.timezone };
    const timeString = new Date(now).toLocaleString('en-US', options).replace(/,/g, '');

    let hT = parseInt(timeString[0]);
    let hU = parseInt(timeString[1]);
    let mT = parseInt(timeString[3]);
    let mU = parseInt(timeString[4]);
    let sT = parseInt(timeString[6]);
    let sU = parseInt(timeString[7]);

    const localHour = parseInt(timeString.substring(0, 2));
    if (localHour >= 6 && localHour < 20) {
      this.dayNightIcon.innerHTML = dayIcon;
    } else {
      this.dayNightIcon.innerHTML = nightIcon;
    }

    this.updateDigit(this.hourTens, hT, 3);
    this.updateDigit(this.hourUnits, hU, 10);
    this.updateDigit(this.minTens, mT, 6);
    this.updateDigit(this.minUnits, mU, 10);
    this.updateDigit(this.secTens, sT, 6);
    this.updateDigit(this.secUnits, sU, 10);
  }
}

// Crea las instancias de la clase Clock para cada reloj
const clockObjects = clocksConfig.map(cfg => new Clock(cfg));

// Función para el "tick" sincronizado del reloj (actualiza cada segundo)
function tick() {
    const now = new Date();
    clockObjects.forEach(c => c.update(now));
    setTimeout(tick, 1000 - (Date.now() % 1000));
}
tick();

/*
=================================================
  EVENTOS DE ARRASTRE (DRAG-AND-DROP) Y DOBLE CLIC
  - Gestiona el movimiento de los relojes.
  - Añade la funcionalidad de doble clic para abrir el link.
=================================================
*/
document.addEventListener('DOMContentLoaded', (event) => {
    let activeItem = null;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;

    document.addEventListener("mousedown", dragStart, false);
    document.addEventListener("mouseup", dragEnd, false);
    document.addEventListener("mousemove", drag, false);

    function dragStart(e) {
        // Ignora el arrastre si el clic es en la barra de encabezado o en las coordenadas
        if (e.target.closest('#header-bar') || e.target.closest('.coordinates')) {
            activeItem = null;
            return;
        }
        const item = e.target.closest('.clock-container');
        if (item) {
            activeItem = item;
            activeItem.classList.add('moving');
            
            const rect = activeItem.getBoundingClientRect();
            initialX = e.clientX - rect.left;
            initialY = e.clientY - rect.top;
        }
    }

    function dragEnd(e) {
        if (activeItem) {
            activeItem.classList.remove('moving');
        }
        activeItem = null;
    }

    function drag(e) {
        if (activeItem) {
            e.preventDefault();
            xOffset = e.clientX - initialX;
            yOffset = e.clientY - initialY;
            setTranslate(xOffset, yOffset, activeItem);
        }
    }

    function setTranslate(xPos, yPos, el) {
        el.style.left = xPos + "px";
        el.style.top = yPos + "px";
    }

   // Evento de DOBLE CLIC en el documento
document.body.addEventListener('dblclick', (e) => {
    // Si el doble clic ocurre dentro de un reloj, detenemos la propagación
    if (e.target.closest('.clock-container')) {
        return; 
    }
    // Ignora el doble clic si el evento ocurre dentro de la barra de encabezado o en las coordenadas
    if (e.target.closest('#header-bar') || e.target.closest('.coordinates')) {
        return;
    }
    // Abre el enlace en una nueva ventana
    window.open('https://digihub.galileotechnologies.com/data/perspective/client/DigiHub/', '_blank');
});

});

/*
=================================================
  ACTUALIZACIÓN DEL CLIMA
  - Funciones para obtener y mostrar los datos del clima.
  - Se utiliza la API de WeatherAPI con coordenadas.
=================================================
*/

// Mapeo de códigos de WeatherAPI a clases de clima
// Esto traduce el código numérico de la API a una clase CSS para los efectos visuales
const weatherMap = {
    '1000': 'clear',
    '1003': 'clouds',
    '1006': 'clouds',
    '1009': 'clouds',
    '1030': 'clouds',
    '1063': 'rainy',
    '1069': 'rainy',
    '1072': 'rainy',
    '1087': 'storm',
    '1114': 'clouds',
    '1117': 'clouds',
    '1135': 'clouds',
    '1147': 'clouds',
    '1150': 'rainy',
    '1153': 'rainy',
    '1168': 'rainy',
    '1171': 'rainy',
    '1180': 'rainy',
    '1183': 'rainy',
    '1186': 'rainy',
    '1189': 'rainy',
    '1192': 'rainy',
    '1195': 'rainy',
    '1198': 'rainy',
    '1201': 'rainy',
    '1204': 'rainy',
    '1207': 'rainy',
    '1240': 'rainy',
    '1243': 'rainy',
    '1246': 'rainy',
    '1249': 'rainy',
    '1252': 'rainy',
    '1273': 'storm',
    '1276': 'storm',
    '1279': 'storm',
    '1282': 'storm',
};

// Función para actualizar los efectos visuales del clima
// Remueve clases viejas y añade la nueva según el código del clima
function updateWeatherEffects(elementId, weatherCode) {
    const el = document.getElementById(elementId);
    el.classList.remove('weather-rainy', 'weather-clouds', 'weather-storm');

    const effectClass = weatherMap[weatherCode] || '';
    if (effectClass) {
        el.classList.add(`weather-${effectClass}`);
    }
}

// Función principal para obtener la temperatura y el código del clima
async function fetchWeather(city) {
    try {
        const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city.lat},${city.lon}&aqi=no`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();
        const temperature = data.current.temp_c.toFixed(1);
        document.getElementById(`temp-${city.id}`).textContent = `Temperatura: ${temperature} °C`;
        
        // Se llama a la función que actualiza los efectos visuales
        updateWeatherEffects(city.id, data.current.condition.code);
    } catch (error) {
        console.error(`Error fetching weather data for ${city.city}:`, error);
        document.getElementById(`temp-${city.id}`).textContent = 'Temp. no disponible';
    }
}

// Función que inicia la actualización del clima para todas las ciudades
async function updateWeather() {
    for (const city of clocksConfig) {
        await fetchWeather(city);
    }
}
updateWeather();
// Se actualiza el clima cada 30 minutos (1800000 ms)
setInterval(updateWeather, 1800000);
</script>
</body>
</html>



