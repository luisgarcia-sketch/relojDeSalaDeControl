<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relojes Sala de Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
/* ===== Estilo general ===== */
body {
    background-color: #07121f;
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
}

.dashboard-container {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    background: url('https://e1.pxfuel.com/desktop-wallpaper/415/399/desktop-wallpaper-black-world-map-displaying-17-gallery-for-black-world-1440x900-for-your-mobile-tablet-dark-map.jpg') no-repeat center center fixed;
    background-size: cover;
}

.overlay {
    height: 100%;
    width: 100%;
    background-color: rgba(7, 18, 31, 0.9);
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    overflow: hidden;
    position: relative;
}

/* ===== Títulos de la cabecera ===== */
.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #f7f7f7;
    font-weight: 900;
    font-size: 28px;
    margin-bottom: 20px;
}
.header-title {
    color: #00aaff;
}
.header-control {
    color: #f7f7f7;
}

/* ===== Contenedor de cada reloj ===== */
.clock-container {
    position: absolute; /* Permite arrastre libre */
    padding: 15px;
    border-radius: 10px;
    background-color: #0b1a2a;
    color: #f7f7f7;
    text-align: center;
    width: 220px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    cursor: grab;
    z-index: 10;
}
.clock-container:active {
    cursor: grabbing;
}
.clock-container.moving {
    z-index: 20;
}

/* ===== Textos y bandera ===== */
.header-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
}
.city-name { 
    font-size: 20px; 
    font-weight: bold; 
    color: #00aaff; 
}
.country-flag {
    width: 25px;
    height: auto;
    border: 1px solid #7b7b7b;
    border-radius: 2px;
}
.day-night-icon {
    width: 25px;
    height: 25px;
}
.day-night-icon svg {
    fill: #f7f7f7;
    width: 100%;
    height: 100%;
}
.country-name { 
    font-size: 14px; 
    margin-bottom: 10px; 
    color: #7b7b7b; 
}
.temperature { 
    font-size: 18px; 
    margin-top: 5px; 
    color: #9e9e9e;
}

/* ===== Reloj ===== */
.clock { 
    display: flex; 
    justify-content: center; 
    gap: 2px; 
    align-items: center;
}

.digit { 
    font-family: 'Montserrat', sans-serif, monospace;
    font-size: 50px;
    font-weight: 500;
    width: 33px; 
    height: 40px; 
    overflow: hidden; 
    position: relative; 
    text-shadow: 0 0 2px currentColor; 
    color: #f7f7f7;
}
.gray-digit { color: #7b7b7b; }

.separator { 
    font-family: 'Montserrat', monospace; 
    font-size: 42px;
    font-weight: bold;
    line-height: 56px;
    transform: translateY(-2px);
    margin: 0 -1px;
    color: #f7f7f7;
}
.separator.gray { color: #7b7f7b; }

/* ===== Animación de dígitos ===== */
.chain {
    position: absolute;
    top: 0;
    left: 0;
    transition: transform 0.9s cubic-bezier(0.8, 0, 0.2, 1);
}
.chain.no-transition { transition: none; }
.chain div { height: 39px; line-height: 39px; text-align: center; }
</style>
</head>
<body>

<div class="dashboard-container">
    <div class="overlay">
        <div class="header-container">
            <div class="header-title">GLOBAL SCADA GALILEO</div>
            <div class="header-control">Sala de Control</div>
        </div>
        <div id="clocks-root"></div>
    </div>
</div>

<script>
const digitHeight = 39;
const apiKey = '7bdc692617af4947d3658fa386581f88';

// Lista completa de relojes con su configuración y POSICIÓN INICIAL
const clocksConfig = [
    { id: 'mendoza', city: 'Mendoza', displayName: 'Mendoza', country: 'Argentina', timezone: 'America/Argentina/Mendoza', flag: 'https://flagcdn.com/w20/ar.png', top: 80, left: 20 },
    { id: 'midland', city: 'Midland', displayName: 'Midland', country: 'USA', timezone: 'America/Chicago', flag: 'https://flagcdn.com/w20/us.png', top: 80, left: 280 },
    { id: 'piura', city: 'Piura', displayName: 'Piura', country: 'Perú', timezone: 'America/Lima', flag: 'https://flagcdn.com/w20/pe.png', top: 80, left: 540 },
    { id: 'mato-grosso', city: 'Mato Grosso do Sul', displayName: 'Mato Grosso do Sul', country: 'Brazil', timezone: 'America/Campo_Grande', flag: 'https://flagcdn.com/w20/br.png', top: 80, left: 800 },
    { id: 'northern-ireland', city: 'Northern Ireland', displayName: 'Northern Ireland', country: 'UK', timezone: 'Europe/London', flag: 'https://flagcdn.com/w20/gb.png', top: 80, left: 1060 },
    { id: 'sucre', city: 'Sucre', displayName: 'Sucre', country: 'Colombia', timezone: 'America/Bogota', flag: 'https://flagcdn.com/w20/co.png', top: 300, left: 20 },
    { id: 'gail', city: 'Gail', displayName: 'Gail', country: 'India', timezone: 'Asia/Kolkata', flag: 'https://flagcdn.com/w20/in.png', top: 300, left: 280 },
    { id: 'toronto', city: 'Toronto', displayName: 'Toronto', country: 'Canada', timezone: 'America/Toronto', flag: 'https://flagcdn.com/w20/ca.png', top: 300, left: 540 },
    { id: 'paris', city: 'Paris', displayName: 'Paris', country: 'France', timezone: 'Europe/Paris', flag: 'https://flagcdn.com/w20/fr.png', top: 300, left: 800 },
    { id: 'tokyo', city: 'Tokyo', displayName: 'Tokyo', country: 'Japan', timezone: 'Asia/Tokyo', flag: 'https://flagcdn.com/w20/jp.png', top: 300, left: 1060 }
];

// Código SVG para los iconos de día y noche
const dayIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 20h2v3h-2v-3zM3.515 4.929l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm16.97 16.97l1.414-1.414-2.121-2.121-1.414 1.414 2.121 2.121zm-2.121-2.121l1.414 1.414 2.121-2.121-1.414-1.414-2.121 2.121zM5.636 18.364l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM1 11h3v2H1v-2zm20 0h3v2h-3v-2zm-3.586-5.414l-1.414-1.414-2.121 2.121 1.414 1.414 2.121-2.121zM4.293 19.707l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121z"/></svg>`;
const nightIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21a9 9 0 0 1-9-9c0-.943.176-1.85.518-2.693A6.5 6.5 0 1 0 18.5 19.5c.928-.291 1.776-.78 2.502-1.432A9 9 0 0 1 12 21z"/></svg>`;

// Genera la cadena de dígitos
function createChain(max) {
    let html = "";
    for (let i = 0; i < max; i++) html += `<div>${i}</div>`;
    html += `<div>0</div>`; // extra para rollover
    return html;
}

// Genera el HTML de un reloj con posición inicial
function createClockHTML(cfg) {
    return `
    <div class="clock-container" id="${cfg.id}" style="top: ${cfg.top}px; left: ${cfg.left}px;">
        <div class="header-row">
            <img class="country-flag" src="${cfg.flag}" alt="${cfg.country} flag">
            <div class="city-name">${cfg.displayName}</div>
            <div class="day-night-icon" id="day-night-icon-${cfg.id}"></div>
        </div>
        <div class="country-name">${cfg.country}</div>
        <div class="clock">
          <div class="digit"><div class="chain" data-role="hourTens">${createChain(3)}</div></div>
          <div class="digit"><div class="chain" data-role="hourUnits">${createChain(10)}</div></div>
          <div class="separator">:</div>
          <div class="digit"><div class="chain" data-role="minTens">${createChain(6)}</div></div>
          <div class="digit"><div class="chain" data-role="minUnits">${createChain(10)}</div></div>
          <div class="separator gray">:</div>
          <div class="digit gray-digit"><div class="chain" data-role="secTens">${createChain(6)}</div></div>
          <div class="digit gray-digit"><div class="chain" data-role="secUnits">${createChain(10)}</div></div>
        </div>
        <div class="temperature" id="temp-${cfg.id}">Temperatura: -- °C</div>
    </div>`;
}

// Insertar relojes en el DOM
const root = document.getElementById("clocks-root");
clocksConfig.forEach(cfg => root.innerHTML += createClockHTML(cfg));

// Clase Clock
class Clock {
  constructor(cfg) {
    this.cfg = cfg;
    const el = document.getElementById(cfg.id);
    this.hourTens = el.querySelector('[data-role="hourTens"]');
    this.hourUnits= el.querySelector('[data-role="hourUnits"]');
    this.minTens  = el.querySelector('[data-role="minTens"]');
    this.minUnits = el.querySelector('[data-role="minUnits"]');
    this.secTens  = el.querySelector('[data-role="secTens"]');
    this.secUnits = el.querySelector('[data-role="secUnits"]');
    this.dayNightIcon = document.getElementById(`day-night-icon-${cfg.id}`);
  }

  updateDigit(element, currentValue, max) {
    let prev = parseInt((element.style.transform || "translateY(0px)").replace(/[^0-9]/g,""))/digitHeight || 0;
    if (currentValue === 0 && prev === max-1) {
      element.style.transform = `translateY(-${max*digitHeight}px)`;
      setTimeout(()=>{
        element.classList.add("no-transition");
        element.style.transform = `translateY(0px)`;
        setTimeout(()=>element.classList.remove("no-transition"),50);
      },900);
      return;
    }
    element.style.transform = `translateY(-${currentValue*digitHeight}px)`;
  }

  update(baseDate) {
    const now = new Date(baseDate);
    const options = {hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: this.cfg.timezone};
    const timeString = new Date(now).toLocaleString('en-US', options).replace(/,/g, '');
    
    let hT = parseInt(timeString[0]);
    let hU = parseInt(timeString[1]);
    let mT = parseInt(timeString[3]);
    let mU = parseInt(timeString[4]);
    let sT = parseInt(timeString[6]);
    let sU = parseInt(timeString[7]);

    const localHour = parseInt(timeString.substring(0, 2));
    if (localHour >= 6 && localHour < 20) {
      this.dayNightIcon.innerHTML = dayIcon;
    } else {
      this.dayNightIcon.innerHTML = nightIcon;
    }

    this.updateDigit(this.hourTens, hT, 3);
    this.updateDigit(this.hourUnits, hU, 10);
    this.updateDigit(this.minTens, mT, 6);
    this.updateDigit(this.minUnits, mU, 10);
    this.updateDigit(this.secTens, sT, 6);
    this.updateDigit(this.secUnits, sU, 10);
  }
}

// Crear instancias de relojes
const clockObjects = clocksConfig.map(cfg => new Clock(cfg));

// Tick sincronizado
function tick() {
    const now = new Date();
    clockObjects.forEach(c => c.update(now));
    setTimeout(tick, 1000 - (Date.now() % 1000));
}
tick();

// Función de arrastre (drag-and-drop)
document.addEventListener('DOMContentLoaded', (event) => {
    let activeItem = null;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;

    document.addEventListener("mousedown", dragStart, false);
    document.addEventListener("mouseup", dragEnd, false);
    document.addEventListener("mousemove", drag, false);

    function dragStart(e) {
        const item = e.target.closest('.clock-container');
        if (item) {
            activeItem = item;
            activeItem.classList.add('moving');
            
            const rect = activeItem.getBoundingClientRect();
            initialX = e.clientX - rect.left;
            initialY = e.clientY - rect.top;
        }
    }

    function dragEnd(e) {
        if (activeItem) {
            activeItem.classList.remove('moving');
        }
        activeItem = null;
    }

    function drag(e) {
        if (activeItem) {
            e.preventDefault();
            xOffset = e.clientX - initialX;
            yOffset = e.clientY - initialY;
            setTranslate(xOffset, yOffset, activeItem);
        }
    }

    function setTranslate(xPos, yPos, el) {
        el.style.left = xPos + "px";
        el.style.top = yPos + "px";
    }

    // Añadir el evento de clic al cuerpo de la página
    document.body.addEventListener('click', (e) => {
        // Comprobar si el clic se realizó en un contenedor de reloj
        const clickedOnClock = e.target.closest('.clock-container');

        // Si no se hizo clic en un reloj, abrir el enlace
        if (!clickedOnClock) {
            window.open('https://digihub.galileotechnologies.com/data/perspective/client/DigiHub/', '_blank');
        }
    });
});

// Función para obtener la temperatura de una ciudad
async function fetchWeather(city) {
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city.city}&appid=${apiKey}&units=metric`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();
        const temperature = data.main.temp.toFixed(1);
        document.getElementById(`temp-${city.id}`).textContent = `Temperatura: ${temperature} °C`;
    } catch (error) {
        console.error(`Error fetching weather data for ${city.city}:`, error);
    }
}

// Función que actualiza la temperatura para todas las ciudades
async function updateWeather() {
    for (const city of clocksConfig) {
        await fetchWeather(city);
    }
}
updateWeather();
setInterval(updateWeather, 1800000); // 30 minutos
</script>
</body>
</html>